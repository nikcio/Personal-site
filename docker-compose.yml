version: '3'

services:
  website-fe:
    build:
      context: frontend/personal-site
    ports:
      - "4500:3000"
    labels:
      - "traefik.enable=true"
      - "traefik.tcp.routers.website-fe.entrypoints=defaultsecure"
      - "traefik.tcp.routers.website-fe.rule=HostSNI(`nikcio.com`)"
  traefik:
    # The official v2 Traefik docker image
    image: traefik:v2.5
    ports:
      # The HTTP port
      - "80:80"
      # The HTTPS port
      - "433:433"
      # The Web UI (enabled by --api.insecure=true)
      - "8080:8080"
    volumes:
      # So that Traefik can listen to the Docker events
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./traefik:/etc/traefik:ro
      - ./logs:/logs
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.traefik.entrypoints=dashboard"
      - "traefik.http.routers.dashboard.rule=Host(`traefik.nikcio.com`) && (PathPrefix(`/api`) || PathPrefix(`/dashboard`))"
      - "traefik.http.routers.dashboard.service=api@internal"
      - "traefik.http.routers.dashboard.middlewares=auth"
      - "traefik.http.middlewares.auth.basicauth.users=nikcio:$$2y$$10$$WSBSiLhEF.8PGYOuTKuGEuKfxhUQ9l8dkqUvPOowUfwWO5PQg.bT6"

networks:
  default:
    external:
      name: traefik_net